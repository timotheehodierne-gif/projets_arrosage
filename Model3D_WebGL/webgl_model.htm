<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Test GLTF (importmap)</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #scene { width: 100vw; height: 100vh; }
  </style>

  <!-- Import map : on indique au navigateur où trouver "three" -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
    }
  }
  </script>
</head>

<body>
  <div id="scene"></div>

  <script type="module">
    import * as THREE from "three";
	import { OBJLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/OBJLoader.js";
	import { MTLLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/MTLLoader.js";
	import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";


    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.set(0, 1, 3);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById("scene").appendChild(renderer.domElement);

    // Lumières
    const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
    scene.add(light);

    const dir = new THREE.DirectionalLight(0xffffff, 1);
    dir.position.set(3, 10, 10);
    scene.add(dir);
	
	// Ajout des contrôles de la caméra
	const controls = new OrbitControls(camera, renderer.domElement);
	controls.enableDamping = true; // effet "inertie"
	controls.dampingFactor = 0.05;
	controls.screenSpacePanning = true; // permet le pan en 2D
	controls.minDistance = 1; // distance minimale de zoom
	controls.maxDistance = 100; // distance maximale de zoom	

    // Chargement du modèle OBJ
	
	const mtlLoader = new MTLLoader();
	mtlLoader.load("./Assemblage_initial.mtl", (materials) => {
	  materials.preload();

	  const objLoader = new OBJLoader();
	  objLoader.setMaterials(materials);
	  objLoader.load("./Assemblage_initial.obj", (obj) => {
		obj.scale.set(10, 10, 10);
		obj.rotation.x -= 0.9*Math.PI;
		//obj.position.x -= 0.5;
		obj.position.y -= 1;

		scene.add(obj);
	  });
	});
	


    // Adaptation à la taille de la fenêtre
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

	// Boucle d’animation
	function animate() {
	  requestAnimationFrame(animate);
	  
	  controls.update(); // mise à jour des contrôles

	  renderer.render(scene, camera);
	}
	animate();
  </script>
</body>
</html>
